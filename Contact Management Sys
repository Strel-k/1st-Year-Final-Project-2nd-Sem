//Contact Management System
//Search still sucks balls.
#include<stdio.h>
#include<stdlib.h>
#include<string.h>
#define max 2048

struct Contact {
	char name[max];
	char number[max];
	char final_cont[max];
};

void DisplayAll(void) {
	FILE* dp;
	dp = fopen("Contact.txt", "r");
	char str1[max];
	int i = 0;
	printf("No. | Name | Contact No.|\n");
	printf("-----------------------------------\n");
	while (fgets(str1,max,dp)!=NULL) {
		printf("[%d] %s", i+1, str1);
		i++;
	}
	printf("-----------------------------------\n");
	printf("\nTotal Contacts: %d", i);
	printf("\n");
	fclose(dp);
}

int main(void) {
	struct Contact s1;
	FILE* fp;
	FILE* temp;
	int a = NULL;
	int current_line, delete_line;
	char search[max], buffer[max], searched[max];
	while (a != 5) {
		system("cls");
		printf("Contact Management System\n\n[1]Add Contact\n[2]Display Contact(s)\n[3]Search Contact\n[4]Delete Contact\n[5]Exit\n\n");
		printf("Choice:");
		scanf("%d", &a);
		switch (a) {
		case 1: system("cls");
			fp = fopen("Contact.txt", "a+");
			printf("Enter Name of Contact:");
			scanf(" %[^\n]s", s1.name);
			printf("Enter Contact No.:");
			scanf(" %[^\n]s", s1.number);
			strcat(s1.name, " ");
			strcat(s1.name, s1.number);
			strcpy(s1.final_cont, s1.name);
			strcat(s1.final_cont, "\n");
			fputs(s1.final_cont, fp);
			printf("Contact Added!\n");
			system("pause");
			fclose(fp);
			break;
		case 2: system("cls");
			DisplayAll();
			system("pause");
			break;
		case 3: system("cls");
			fp = fopen("Contact.txt", "r+");
			printf("Enter Name to be Searched:");
			scanf(" %[^\n]s", search);
			while (fgets(buffer, max, fp) != NULL) {
				if (strcmp(buffer,search) >= 1) {
					strcpy(searched, buffer);
					break;
				}	
				else {
					strcpy(searched, "User not Found!");
				}
			} 
			printf("\n");
			printf("%s", searched);
			printf("\n");
			system("pause");
			fclose(fp);
			break;
		case 4: system("cls");
			current_line = NULL;
			delete_line = NULL;
			fp = fopen("Contact.txt", "r");
			temp = fopen("Temp.txt", "w+");
			DisplayAll();
			printf("\nEnter Line to Delete:");
			scanf("%d", &delete_line);
			while (fgets(buffer, max, fp) != NULL) {
				current_line++;
				if (current_line != delete_line) {
					fputs(buffer, temp);
				}
				
			}
			fclose(fp);
			fclose(temp);
			remove("Contact.txt");
			rename("Temp.txt", "Contact.txt");
			printf("\nContact Deleted!\n");
			system("pause");
			break;

		case 5: break;
		}
	}
	return 0;
}
